{"version":3,"file":"topnav.js","sources":["../../../src/js/components/topnav.ts"],"sourcesContent":["/**\n * TOP NAV & BANNER\n * Add scroll class to sticky topnav if animate-timeline: scroll() is not supported\n */\n\nconst POLYFILL_DELAY = 1000\nconst TOPNAV_SELECTOR = \".topnav\"\nconst SCROLL_CLASS = \"scroll\"\nconst BANNER_SELECTOR = \".notification-banner\"\nconst BANNER_HIDE_CLASS = \"banner-hide\"\nconst BANNER_SHOW_CLASS = \"banner-show-fixed\"\nconst BODY_SELECTOR = \"body\"\nconst CONTAINER_SELECTOR = \"#preview-container\"\nlet REPOSITIONED = false\n\ninterface PageElem extends HTMLElement {\n  dataset: {\n    fixedMarginBase: string\n  }\n}\n\nconst observeTopnav = (topnav: HTMLElement, banner: HTMLElement) => {\n  const observer = new MutationObserver((mutations) => {\n    mutations.forEach((mutation) => {\n      if (mutation.attributeName === \"style\") {\n        const pos = getComputedStyle(topnav).getPropertyValue(\"position\")\n        if (pos === \"fixed\") {\n          observer.disconnect()\n          if (!REPOSITIONED) {\n            positionBanner(banner, topnav)\n          }\n        }\n      }\n    })\n  })\n  observer.observe(topnav, {\n    attributes: true,\n    attributeFilter: [\"style\"],\n  })\n  return observer\n}\n\n// Position banner when topnav is position:fixed\n// When topnav is not fixed, banner CSS handles the positioning\nconst positionBanner = (banner: HTMLElement, topnav: HTMLElement) => {\n  if (!banner || !topnav) {\n    return\n  }\n  // console.log(\"positionBanner:\", banner, topnav)\n\n  const navRect = topnav.getBoundingClientRect()\n  const bannerRect = banner.getBoundingClientRect()\n  banner.style.setProperty(\"--_top\", `${navRect.bottom}px`)\n  banner.classList.add(BANNER_SHOW_CLASS)\n  const container = document.querySelector(CONTAINER_SELECTOR) as PageElem\n  if (container) {\n    // Cache the original top margin set by GHL vue\n    // Vue sets the top margin to offset the position of a sticky topnav\n    if (!container.dataset.fixedMarginBase) {\n      const baseMargin =\n        getComputedStyle(container).getPropertyValue(\"margin-top\")\n      container.dataset.fixedMarginBase = baseMargin\n    }\n    let margin = parseInt(container.dataset.fixedMarginBase) || 0\n    margin = margin + bannerRect.height\n    if (banner.nextElementSibling) {\n      margin =\n        margin +\n          parseInt(\n            getComputedStyle(banner.nextElementSibling).getPropertyValue(\n              \"margin-top\"\n            )\n          ) || 0\n    }\n    margin = Math.round(margin)\n    container.style.setProperty(\"margin-top\",`${margin}px`)\n  }\n\n  REPOSITIONED = true\n}\n\nconst setBanner = (topnav: HTMLElement) => {\n  const banner = document.querySelector(BANNER_SELECTOR) as HTMLElement\n\n  if (!banner) {\n    return\n  }\n  if (getComputedStyle(banner).getPropertyValue(\"display\") === \"none\") {\n    return\n  }\n\n  // Listen for click event on banner close button\n  function closeEvent(this: HTMLElement, event: Event) {\n    banner.classList.add(BANNER_HIDE_CLASS)\n    // Reset to original top margin size\n    // This probably shouldn't be used since it causes the page content to shift up\n    // const container = document.querySelector(CONTAINER_SELECTOR) as PageElem\n    // if (container.dataset.fixedMarginBase) {\n    //   container.style.setProperty(\n    //     \"margin-top\",\n    //     container.dataset.fixedMarginBase\n    //   )\n    // }\n  }\n  const closeBtn = banner.querySelector(\".btn-close\")\n  closeBtn?.addEventListener(\"click\", closeEvent)\n\n  const navPos = getComputedStyle(topnav).getPropertyValue(\"position\")\n  if (navPos !== \"fixed\" || !topnav.parentElement) {\n    return observeTopnav(topnav, banner)\n  }\n  return positionBanner(topnav, banner)\n}\n\n// Add a hidden div above the topnav to use to observe when it's scrolled\n// in and out of view. Toggle the SCROLL_CLASS accordinly to trigger\n// the box shadow and any animations defined in CSS.\nconst scrollPolyfill = (topnav: HTMLElement) => {\n  if (!topnav) {\n    return\n  }\n  console.log('Level Up: Adding nav scroll polyfill')\n  const intercept = document.createElement(\"div\")\n  intercept.setAttribute(\"data-observer-intercept\", \"\")\n  // Insert into the body container to prevent any timing issues with vue updating the dom\n  const container = document.querySelector(BODY_SELECTOR) as HTMLElement\n  container.insertBefore(intercept, container.firstChild)\n  const observer = new IntersectionObserver(([entry]) => {\n    topnav.classList.toggle(SCROLL_CLASS, !entry?.isIntersecting)\n  })\n  observer.observe(intercept)\n}\n\n// Use polyfill of sorts if browser does not support animation-timeline:scroll() css\nconst run = () => {\n  const topnav = document.querySelector(TOPNAV_SELECTOR) as HTMLElement\n  setBanner(topnav)\n  if (CSS.supports(\"animation-timeline:scroll()\")) {\n    return\n  }\n  // Delay to allow  time for vue to update topnav\n  setTimeout(() => {\n    scrollPolyfill(topnav)\n  }, POLYFILL_DELAY)\n}\n\nexport default {\n  run,\n}\n"],"names":[],"mappings":"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"}